@model SideXC.WebUI.Models.Inventory.Supplier

@{
    ViewData["Title"] = "Supplier - Edit Item";
}

@Html.AntiForgeryToken()

<main id="js-page-content" role="main" class="page-content">
    <ol class="breadcrumb page-breadcrumb">
        <li class="breadcrumb-item"><a href="/#">Home</a></li>
        <li class="breadcrumb-item">Inventory</li>
        <li class="breadcrumb-item active"><a href="@Url.Action("Index", "Suppliers")">Suppliers</a></li>
        <li class="position-absolute pos-top pos-right d-none d-sm-block"><span class="js-get-date"></span></li>
    </ol>
    <div class="row">
        <div class="col-xl-12">
            <div id="panel-1" class="panel">
                <div class="panel-hdr">
                    <h2>
                        Edit Item
                    </h2>
                    <div class="panel-toolbar">
                        <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10" data-original-title="Collapse"></button>
                        <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip" data-offset="0,10" data-original-title="Fullscreen"></button>
                    </div>
                </div>
                <div class="panel-container show">
                    <div class="panel-content">
                        <form asp-action="Edit">
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <input type="hidden" asp-for="Id" />
                            <input type="hidden" id ="hddAddressId" name="hddAddressId" value="@Model.Address.Id"/>
                            <div class="row">
                                <div class="col-md-12">

                                    <div id="smartwizard">
                                        <ul>
                                            <li><a href="#step-1">General Data</a></li>
                                            <li><a href="#step-2">Address</a></li>
                                            <li><a href="#step-3">Contacts</a></li>
                                        </ul>
                                        <div class="p-3">
                                            <div id="step-1" class="">
                                                <div class="form-row">
                                                    <div class="col-md-12 mb-3">
                                                        <label class="text-secondary">
                                                            Type the general information for this new Supplier.
                                                        </label>
                                                    </div>
                                                    <div class="col-md-4 mb-3">
                                                        <label asp-for="Name" class="control-label">Supplier Name</label>
                                                        <input asp-for="Name" class="form-control form-control-sm" />
                                                        <span asp-validation-for="Name" class="text-danger"></span>
                                                    </div>
                                                    <div class="col-md-2 mb-3">
                                                        <label asp-for="RFC" class="control-label"></label>
                                                        <input asp-for="RFC" class="form-control form-control-sm" />
                                                        <span asp-validation-for="RFC" class="text-danger"></span>
                                                    </div>
                                                    <div class="col-md-2 mb-3">
                                                        <label asp-for="PaymentDay" class="control-label">Payment Day</label>
                                                        <input asp-for="PaymentDay" class="form-control form-control-sm" />
                                                        <span asp-validation-for="PaymentDay" class="text-danger"></span>
                                                    </div>
                                                    <div class="col-md-4 mb-3">
                                                        <label asp-for="Email" class="control-label">Email Address</label>
                                                        <input asp-for="Email" class="form-control form-control-sm" />
                                                        <span asp-validation-for="Email" class="text-danger"></span>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="PaymentMethod" class="control-label">Payement Method </label>
                                                        <select asp-for="PaymentMethod" class="form-control form-control-sm" asp-items="@(new SelectList(ViewBag.PaymentMethods,"Value", "Text"))">
                                                            <option value="">-Please select one-</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="Currrency" class="control-label">Currency </label>
                                                        <select asp-for="Currency" class="form-control form-control-sm" asp-items="@(new SelectList(ViewBag.Currencies,"Value", "Text"))">
                                                            <option value="">-Please select one-</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-12 mb-3">
                                                        <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input" asp-for="Active">
                                                            <label class="custom-control-label" for="Active">Status</label>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                            <div id="step-2" class="">
                                                <div class="form-row">
                                                    <div class="col-md-12 mb-3">
                                                        <label class="text-secondary">
                                                            Type the correct information, remember with the zip code you can get the all information.
                                                        </label>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="txtStreet" class="control-label">Street</label>
                                                        <input id="txtStreet" name="txtStreet" class="form-control form-control-sm" value="@Model.Address.Street" required />
                                                        <span validation-for="txtStreet" class="text-danger"></span>
                                                    </div>
                                                    <div class="col-md-2 mb-3">
                                                        <label for="txtExternalNumber" class="control-label">External Number</label>
                                                        <input id="txtExternalNumber" name="txtExternalNumber" class="form-control form-control-sm" value="@Model.Address.ExternalNumber" required />
                                                        <span validation-for="txtExternalNumber" class="text-danger"></span>
                                                    </div>
                                                    <div class="col-md-2 mb-3">
                                                        <label for="txtInternalNumber" class="control-label">Internal Number</label>
                                                        <input id="txtInternalNumber" name="txtInternalNumber" class="form-control form-control-sm" value="@Model.Address.InternalNumber" required />
                                                        <span validation-for="txtInternalNumber" class="text-danger"></span>
                                                    </div>
                                                    <div class="col-md-2 mb-3">
                                                        <label for="txtZipCode" class="control-label">Zip Code</label>
                                                        <input id="txtZipCode" name="txtZipCode" class="form-control form-control-sm" value="@Model.Address.Neighborhood.ZipCode" required />
                                                        <span validation-for="txtZipCode" class="text-danger"></span>
                                                    </div>

                                                    <div class="col-md-3 mb-3">
                                                        <label for="ddColonia" class="control-label">Neighborhood</label>
                                                        <select class="form-control form-control-sm" name="ddColonia" id="ddColonia">
                                                            <option value="">-Please select one-</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label for="lblMunicipio" class="control-label">City</label>
                                                        <label id="lblMunicipio" class="form-control form-control-sm">---</label>
                                                    </div>

                                                    <div class="col-md-3 mb-3">
                                                        <label for="lblEstado" class="control-label">State</label>
                                                        <label id="lblEstado" class="form-control form-control-sm">---</label>
                                                    </div>
                                                    <div class="col-md-3 mb-3">
                                                        <label for="lblPais" class="control-label">Country</label>
                                                        <label id="lblPais" class="form-control form-control-sm">---</label>
                                                    </div>

                                                </div>
                                            </div>
                                            <div id="step-3" class="">
                                                <div class="form-row">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>

                            <button class="btn btn-info" type="submit"><span class="fa fa-save"></span>&nbsp; Save</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>
</main>

<link rel="stylesheet" media="screen, print" href="css/formplugins/smartwizard/smartwizard.css">

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script src="js/formplugins/smartwizard/smartwizard.js"></script>
    <script src="~/js/utilities/common.js"></script>

    <script>

        $(document).ready(function () {

            FillData();

            $("#txtZipCode").change(function () {
                GetColoniasInfo($(this).val(), false);
            });

            // Smart Wizard
            $('#smartwizard').smartWizard(
                {
                    selected: 0, // Initial selected step, 0 = first step
                    keyNavigation: true, // Enable/Disable keyboard navigation(left and right keys are used if enabled)
                    autoAdjustHeight: false, // Automatically adjust content height
                    cycleSteps: false, // Allows to cycle the navigation of steps
                    backButtonSupport: true, // Enable the back button support
                    useURLhash: false, // Enable selection of the step based on url hash
                    showStepURLhash: false,
                    lang:
                    { // Language variables
                        next: 'Next',
                        previous: 'Previous'
                    },
                    toolbarSettings:
                    {
                        toolbarPosition: 'bottom', // none, top, bottom, both
                        toolbarButtonPosition: 'right', // left, right
                        showNextButton: true, // show/hide a Next button
                        showPreviousButton: true, // show/hide a Previous button
                        /*toolbarExtraButtons: [
                $('<button></button>').text('Finish')
                              .addClass('btn btn-info')
                              .on('click', function(){
                            alert('Finsih button click');
                              }),
                $('<button></button>').text('Cancel')
                              .addClass('btn btn-danger')
                              .on('click', function(){
                            alert('Cancel button click');
                              })
                          ]*/
                    },
                    anchorSettings:
                    {
                        anchorClickable: true, // Enable/Disable anchor navigation
                        enableAllAnchors: false, // Activates all anchors clickable all times
                        markDoneStep: true, // add done css
                        enableAnchorOnDoneStep: true // Enable/Disable the done steps navigation
                    },
                    contentURL: null, // content url, Enables Ajax content loading. can set as data data-content-url on anchor
                    contentCache: true, //ajax content
                    disabledSteps: [], // Array Steps disabled
                    errorSteps: [], // Highlight step with errors
                    theme: 'default', //dots, default, circles
                    transitionEffect: 'slide', // Effect on navigation, none/slide/fade
                    transitionSpeed: '400'
                });

        });

        var FillData = function () {
            $('#PaymentMethod').val(@Model.PaymentMethod.Id);
            $('#Currency').val(@Model.Currency.Id);

            GetColoniasInfo(@Model.Address.Neighborhood.ZipCode, true);
        }

        function GetColoniasInfo(zipCode, initial){
            _CallMethod('Employees', 'BuscarCodigoPostal', { zipcode: zipCode  }, function (_result) {
                _datos = JSON.parse(_result);
                DropDownColonias(_datos, initial);

                $("#lblPais").text(_datos[0].Pais);
                $("#lblEstado").text(_datos[0].Estado);
                $("#lblMunicipio").text(_datos[0].Municipio);
            });

        }

        function DropDownColonias(data, initial) {
            var ddColonias = $("#ddColonia");
            ddColonias.empty();
            var procemessage = '<option value="">Selecciona una Colonia</option>';
            ddColonias.html(procemessage).show();

            for (var x = 0; x < data.length; x++) {
                var option = $("<option />").attr("value", data[x].idColonia).text(data[x].Colonia);
                ddColonias.append(option);
            }

            if (initial) $("#ddColonia").val(@Model.Address.Neighborhood.Id);
        }

        var _NoContactType = 1;

        var AddNewContact = function () {
            var desciption = $('#txtContactDescription').val();
            var contactType = $('#ddContactType :selected').text();

            if (desciption == "") {
                _AlertSideXC("Please type a Contact Description.", "danger");
                return;
            }
            if (contactType == "") {
                _AlertSideXC("Please select a Contact Type.", "danger");
                return;
            }

            _addCardToRow(_NoContactType++, desciption, contactType, "bg-primary")
        }

        var _addCardToRow = function (id, description, contacttype, bg) {
            var classCol = 'col-sm-3 col-md-3 col-lg-3';
            var textDescription = $('<h4 />').text(description);
            var textContactType = $('<h6 />').addClass("text-left").text(id + ".- " + contacttype);
            var body = $('<div />').addClass('card-body').addClass("text-white").append(textContactType).append(textDescription);
            var card = $('<div />').addClass(classCol).addClass('card ml-1 mr-1 mb-2 text-center ' + bg + ' shadow').append(body);

            $('#divContacts').append(card.fadeIn(1000));
        }

    </script>

}

